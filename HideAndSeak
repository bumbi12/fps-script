getgenv().Teleporting = false
getgenv().WalkSpeed = 16
getgenv().FlySpeed = 50
getgenv().Flying = false
getgenv().GuiEnabled = true
getgenv().AutoCollectCoins = false
getgenv().CoinCheckInterval = 1

local Players = game:GetService("Players")
local LocalPlayer = Players.LocalPlayer
local Mouse = LocalPlayer:GetMouse()
local UserInputService = game:GetService("UserInputService")
local RunService = game:GetService("RunService")
local TweenService = game:GetService("TweenService")
local CoreGui = game:GetService("CoreGui")

local ScreenGui = Instance.new("ScreenGui")
ScreenGui.Name = "CoinExploitUI"
ScreenGui.Parent = CoreGui

local MainFrame = Instance.new("Frame")
MainFrame.Name = "MainFrame"
MainFrame.Size = UDim2.new(0, 280, 0, 250)
MainFrame.Position = UDim2.new(0.5, -140, 0.5, -125)
MainFrame.AnchorPoint = Vector2.new(0.5, 0.5)
MainFrame.BackgroundColor3 = Color3.fromRGB(35, 35, 35)
MainFrame.BorderSizePixel = 0
MainFrame.Active = true
MainFrame.Draggable = true
MainFrame.Parent = ScreenGui

local UICorner = Instance.new("UICorner")
UICorner.CornerRadius = UDim.new(0, 8)
UICorner.Parent = MainFrame

local Title = Instance.new("TextLabel")
Title.Name = "Title"
Title.Size = UDim2.new(1, 0, 0, 30)
Title.Position = UDim2.new(0, 0, 0, 0)
Title.BackgroundColor3 = Color3.fromRGB(25, 25, 25)
Title.TextColor3 = Color3.fromRGB(255, 255, 255)
Title.Text = "COIN EXPLOIT v2.0"
Title.Font = Enum.Font.GothamBold
Title.TextSize = 14
Title.Parent = MainFrame

local TitleCorner = Instance.new("UICorner")
TitleCorner.CornerRadius = UDim.new(0, 8)
TitleCorner.Parent = Title

local SpeedLabel = Instance.new("TextLabel")
SpeedLabel.Name = "SpeedLabel"
SpeedLabel.Size = UDim2.new(0.4, -15, 0, 25)
SpeedLabel.Position = UDim2.new(0, 10, 0, 40)
SpeedLabel.BackgroundTransparency = 1
SpeedLabel.TextColor3 = Color3.fromRGB(255, 255, 255)
SpeedLabel.Text = "Walk Speed:"
SpeedLabel.Font = Enum.Font.Gotham
SpeedLabel.TextSize = 12
SpeedLabel.TextXAlignment = Enum.TextXAlignment.Left
SpeedLabel.Parent = MainFrame

local SpeedBox = Instance.new("TextBox")
SpeedBox.Name = "SpeedBox"
SpeedBox.Size = UDim2.new(0.6, -10, 0, 25)
SpeedBox.Position = UDim2.new(0.4, 5, 0, 40)
SpeedBox.BackgroundColor3 = Color3.fromRGB(50, 50, 50)
SpeedBox.TextColor3 = Color3.fromRGB(255, 255, 255)
SpeedBox.Text = tostring(getgenv().WalkSpeed)
SpeedBox.Font = Enum.Font.Gotham
SpeedBox.TextSize = 12
SpeedBox.Parent = MainFrame

local FlySpeedLabel = Instance.new("TextLabel")
FlySpeedLabel.Name = "FlySpeedLabel"
FlySpeedLabel.Size = UDim2.new(0.4, -15, 0, 25)
FlySpeedLabel.Position = UDim2.new(0, 10, 0, 75)
FlySpeedLabel.BackgroundTransparency = 1
FlySpeedLabel.TextColor3 = Color3.fromRGB(255, 255, 255)
FlySpeedLabel.Text = "Fly Speed:"
FlySpeedLabel.Font = Enum.Font.Gotham
FlySpeedLabel.TextSize = 12
FlySpeedLabel.TextXAlignment = Enum.TextXAlignment.Left
FlySpeedLabel.Parent = MainFrame

local FlySpeedBox = Instance.new("TextBox")
FlySpeedBox.Name = "FlySpeedBox"
FlySpeedBox.Size = UDim2.new(0.6, -10, 0, 25)
FlySpeedBox.Position = UDim2.new(0.4, 5, 0, 75)
FlySpeedBox.BackgroundColor3 = Color3.fromRGB(50, 50, 50)
FlySpeedBox.TextColor3 = Color3.fromRGB(255, 255, 255)
FlySpeedBox.Text = tostring(getgenv().FlySpeed)
FlySpeedBox.Font = Enum.Font.Gotham
FlySpeedBox.TextSize = 12
FlySpeedBox.Parent = MainFrame

local FlyButton = Instance.new("TextButton")
FlyButton.Name = "FlyButton"
FlyButton.Size = UDim2.new(1, -20, 0, 25)
FlyButton.Position = UDim2.new(0, 10, 0, 110)
FlyButton.BackgroundColor3 = Color3.fromRGB(80, 50, 50)
FlyButton.TextColor3 = Color3.fromRGB(255, 255, 255)
FlyButton.Text = "TOGGLE FLY (F)"
FlyButton.Font = Enum.Font.GothamBold
FlyButton.TextSize = 12
FlyButton.Parent = MainFrame

local AutoCollectButton = Instance.new("TextButton")
AutoCollectButton.Name = "AutoCollectButton"
AutoCollectButton.Size = UDim2.new(1, -20, 0, 25)
AutoCollectButton.Position = UDim2.new(0, 10, 0, 145)
AutoCollectButton.BackgroundColor3 = Color3.fromRGB(50, 50, 80)
AutoCollectButton.TextColor3 = Color3.fromRGB(255, 255, 255)
AutoCollectButton.Text = "AUTO COLLECT: OFF"
AutoCollectButton.Font = Enum.Font.GothamBold
AutoCollectButton.TextSize = 12
AutoCollectButton.Parent = MainFrame

local NearestCoinButton = Instance.new("TextButton")
NearestCoinButton.Name = "NearestCoinButton"
NearestCoinButton.Size = UDim2.new(1, -20, 0, 25)
NearestCoinButton.Position = UDim2.new(0, 10, 0, 180)
NearestCoinButton.BackgroundColor3 = Color3.fromRGB(50, 80, 50)
NearestCoinButton.TextColor3 = Color3.fromRGB(255, 255, 255)
NearestCoinButton.Text = "TP TO NEAREST COIN"
NearestCoinButton.Font = Enum.Font.GothamBold
NearestCoinButton.TextSize = 12
NearestCoinButton.Parent = MainFrame

local CoinStatus = Instance.new("TextLabel")
CoinStatus.Name = "CoinStatus"
CoinStatus.Size = UDim2.new(1, -20, 0, 20)
CoinStatus.Position = UDim2.new(0, 10, 0, 215)
CoinStatus.BackgroundTransparency = 1
CoinStatus.TextColor3 = Color3.fromRGB(255, 255, 0)
CoinStatus.Text = "Coins on map: Loading..."
CoinStatus.Font = Enum.Font.Gotham
CoinStatus.TextSize = 12
CoinStatus.TextXAlignment = Enum.TextXAlignment.Left
CoinStatus.Parent = MainFrame

local CloseButton = Instance.new("TextButton")
CloseButton.Name = "CloseButton"
CloseButton.Size = UDim2.new(0, 20, 0, 20)
CloseButton.Position = UDim2.new(1, -25, 0, 5)
CloseButton.BackgroundColor3 = Color3.fromRGB(200, 50, 50)
CloseButton.TextColor3 = Color3.fromRGB(255, 255, 255)
CloseButton.Text = "X"
CloseButton.Font = Enum.Font.GothamBold
CloseButton.TextSize = 12
CloseButton.Parent = MainFrame

local function getCoins()
    local coins = {}
    local coinFolder = workspace:FindFirstChild("GameObjects")
    if coinFolder then
        for _, obj in ipairs(coinFolder:GetChildren()) do
            if obj.Name == "Coin" or obj:IsA("BasePart") then
                table.insert(coins, obj)
            end
        end
    end
    return coins
end

local function updateCoinStatus()
    local coins = getCoins()
    CoinStatus.Text = "Coins on map: "..#coins
end

local function findNearestCoin()
    local character = LocalPlayer.Character
    if not character then return nil end
    
    local rootPart = character:FindFirstChild("HumanoidRootPart") or character:FindFirstChild("Torso")
    if not rootPart then return nil end
    
    local coins = getCoins()
    local nearestCoin = nil
    local shortestDistance = math.huge
    
    for _, coin in ipairs(coins) do
        local distance = (rootPart.Position - coin.Position).Magnitude
        if distance < shortestDistance then
            shortestDistance = distance
            nearestCoin = coin
        end
    end
    
    return nearestCoin
end

local function teleportToCoin()
    local coin = findNearestCoin()
    if coin then
        local character = LocalPlayer.Character
        if not character then return end
        
        local rootPart = character:FindFirstChild("HumanoidRootPart") or character:FindFirstChild("Torso")
        if not rootPart then return end
        
        rootPart.CFrame = CFrame.new(coin.Position + Vector3.new(0, 3, 0))
    end
end

local function autoCollectCoins()
    while getgenv().AutoCollectCoins do
        local coin = findNearestCoin()
        if coin then
            teleportToCoin()
        end
        wait(getgenv().CoinCheckInterval)
    end
end

local flyBodyVelocity, flyBodyGyro

local function startFlying()
    if getgenv().Flying then return end
    
    local character = LocalPlayer.Character
    if not character then return end
    
    local rootPart = character:FindFirstChild("HumanoidRootPart") or character:FindFirstChild("Torso")
    if not rootPart then return end
    
    flyBodyVelocity = Instance.new("BodyVelocity")
    flyBodyVelocity.Velocity = Vector3.new(0, 0, 0)
    flyBodyVelocity.MaxForce = Vector3.new(0, 0, 0)
    flyBodyVelocity.P = 1000
    flyBodyVelocity.Parent = rootPart
    
    flyBodyGyro = Instance.new("BodyGyro")
    flyBodyGyro.MaxTorque = Vector3.new(0, 0, 0)
    flyBodyGyro.P = 1000
    flyBodyGyro.D = 50
    flyBodyGyro.Parent = rootPart
    
    flyBodyVelocity.MaxForce = Vector3.new(9e9, 9e9, 9e9)
    flyBodyGyro.MaxTorque = Vector3.new(9e9, 9e9, 9e9)
    
    getgenv().Flying = true
    FlyButton.BackgroundColor3 = Color3.fromRGB(50, 80, 50)
    FlyButton.Text = "FLYING (F)"
    
    local flyConnection
    flyConnection = RunService.Heartbeat:Connect(function()
        if not getgenv().Flying then 
            flyConnection:Disconnect()
            return 
        end
        
        local character = LocalPlayer.Character
        if not character or not rootPart or rootPart.Parent ~= character then
            getgenv().Flying = false
            flyConnection:Disconnect()
            return
        end
        
        local camera = workspace.CurrentCamera
        local direction = Vector3.new()
        
        if UserInputService:IsKeyDown(Enum.KeyCode.W) then
            direction = direction + (camera.CFrame.LookVector * getgenv().FlySpeed)
        end
        if UserInputService:IsKeyDown(Enum.KeyCode.S) then
            direction = direction - (camera.CFrame.LookVector * getgenv().FlySpeed)
        end
        if UserInputService:IsKeyDown(Enum.KeyCode.A) then
            direction = direction - (camera.CFrame.RightVector * getgenv().FlySpeed)
        end
        if UserInputService:IsKeyDown(Enum.KeyCode.D) then
            direction = direction + (camera.CFrame.RightVector * getgenv().FlySpeed)
        end
        if UserInputService:IsKeyDown(Enum.KeyCode.Space) then
            direction = direction + Vector3.new(0, getgenv().FlySpeed, 0)
        end
        if UserInputService:IsKeyDown(Enum.KeyCode.LeftShift) then
            direction = direction - Vector3.new(0, getgenv().FlySpeed, 0)
        end
        
        flyBodyVelocity.Velocity = direction
        flyBodyGyro.CFrame = camera.CFrame
    end)
end

local function stopFlying()
    if not getgenv().Flying then return end
    
    if flyBodyVelocity then flyBodyVelocity:Destroy() end
    if flyBodyGyro then flyBodyGyro:Destroy() end
    
    getgenv().Flying = false
    FlyButton.BackgroundColor3 = Color3.fromRGB(80, 50, 50)
    FlyButton.Text = "TOGGLE FLY (F)"
end

local function toggleFly()
    if getgenv().Flying then
        stopFlying()
    else
        startFlying()
    end
end

local function setSpeed(speed)
    if tonumber(speed) then
        getgenv().WalkSpeed = tonumber(speed)
        SpeedBox.Text = tostring(getgenv().WalkSpeed)
        
        if LocalPlayer.Character then
            local humanoid = LocalPlayer.Character:FindFirstChildOfClass("Humanoid")
            if humanoid then
                humanoid.WalkSpeed = getgenv().WalkSpeed
            end
        end
    end
end

local function setFlySpeed(speed)
    if tonumber(speed) then
        getgenv().FlySpeed = tonumber(speed)
        FlySpeedBox.Text = tostring(getgenv().FlySpeed)
    end
end

local function toggleAutoCollect()
    getgenv().AutoCollectCoins = not getgenv().AutoCollectCoins
    if getgenv().AutoCollectCoins then
        AutoCollectButton.BackgroundColor3 = Color3.fromRGB(50, 80, 50)
        AutoCollectButton.Text = "AUTO COLLECT: ON"
        autoCollectCoins()
    else
        AutoCollectButton.BackgroundColor3 = Color3.fromRGB(50, 50, 80)
        AutoCollectButton.Text = "AUTO COLLECT: OFF"
    end
end

FlyButton.MouseButton1Click:Connect(toggleFly)
AutoCollectButton.MouseButton1Click:Connect(toggleAutoCollect)
NearestCoinButton.MouseButton1Click:Connect(teleportToCoin)

FlySpeedBox.FocusLost:Connect(function(enterPressed)
    if enterPressed then setFlySpeed(FlySpeedBox.Text) end
end)

SpeedBox.FocusLost:Connect(function(enterPressed)
    if enterPressed then setSpeed(SpeedBox.Text) end
end)

CloseButton.MouseButton1Click:Connect(function()
    stopFlying()
    getgenv().AutoCollectCoins = false
    ScreenGui:Destroy()
    getgenv().GuiEnabled = false
end)

UserInputService.InputBegan:Connect(function(input, gameProcessed)
    if not getgenv().GuiEnabled then return end
    
    if input.KeyCode == Enum.KeyCode.F and not gameProcessed then
        toggleFly()
    end
    
    if input.UserInputType == Enum.UserInputType.MouseButton1 and 
       (UserInputService:IsKeyDown(Enum.KeyCode.LeftControl) or UserInputService:IsKeyDown(Enum.KeyCode.RightControl)) then
        local targetPosition = Mouse.Hit.Position
        local character = LocalPlayer.Character
        if character then
            local rootPart = character:FindFirstChild("HumanoidRootPart") or character:FindFirstChild("Torso")
            if rootPart then
                rootPart.CFrame = CFrame.new(targetPosition)
            end
        end
    end
end)

LocalPlayer.CharacterAdded:Connect(function(character)
    wait(0.5)
    setSpeed(getgenv().WalkSpeed)
    if getgenv().Flying then
        wait(0.2)
        startFlying()
    end
end)

UserInputService.InputBegan:Connect(function(input, gameProcessed)
    if gameProcessed then return end
    if input.KeyCode == Enum.KeyCode.F5 then
        MainFrame.Visible = not MainFrame.Visible
    end
end)

setSpeed(getgenv().WalkSpeed)
setFlySpeed(getgenv().FlySpeed)

spawn(function()
    while wait(1) do
        if getgenv().GuiEnabled then
            updateCoinStatus()
        else
            break
        end
    end
end)
